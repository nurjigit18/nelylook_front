{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///E:/nelylook/front/front_nely/app/%28auth%29/account/page.tsx"],"sourcesContent":["// app/account/page.tsx\r\nimport { cookies } from 'next/headers';\r\nimport { redirect } from 'next/navigation';\r\n\r\nconst API = process.env.NEXT_PUBLIC_API_URL;\r\n\r\ntype UserMe = {\r\n  id: number | string;\r\n  email: string;\r\n  first_name?: string | null;\r\n  last_name?: string | null;\r\n  phone?: string | null;\r\n  address?: string | null;\r\n};\r\n\r\nasync function getMe(): Promise<UserMe | null> {\r\n  // Forward the browser cookies to your DRF API for httpOnly session checking\r\n  const cookie = cookies().toString();\r\n  const res = await fetch(`${API}/auth/me/`, {\r\n    method: 'GET',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      Cookie: cookie,\r\n    },\r\n    // avoid caching user data\r\n    cache: 'no-store',\r\n  });\r\n\r\n  if (res.status === 401 || res.status === 403) return null;\r\n  if (!res.ok) throw new Error('Failed to load profile');\r\n  return (await res.json()) as UserMe;\r\n}\r\n\r\nexport default async function AccountPage() {\r\n  const me = await getMe();\r\n  if (!me) {\r\n    // Not logged in -> go to login and come back here\r\n    redirect('/login?next=%2Faccount');\r\n  }\r\n\r\n  return (\r\n    <main className=\"mx-auto w-full max-w-6xl px-4 py-10\">\r\n      <div className=\"grid grid-cols-1 gap-8 md:grid-cols-[220px_1fr]\">\r\n        {/* Sidebar */}\r\n        <aside className=\"space-y-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-semibold tracking-tight\">\r\n              Welcome, {me.first_name ? me.first_name : 'there'}\r\n            </h1>\r\n          </div>\r\n\r\n          <nav className=\"text-sm\">\r\n            <ul className=\"space-y-3\">\r\n              <li>\r\n                <span className=\"cursor-default text-black underline\">Personal Information</span>\r\n              </li>\r\n              <li className=\"text-neutral-500 hover:text-black\">\r\n                <a href=\"/account/orders\">Order history</a>\r\n              </li>\r\n              <li className=\"text-neutral-500 hover:text-black\">\r\n                <a href=\"/account/change-password\">Change Password</a>\r\n              </li>\r\n            </ul>\r\n          </nav>\r\n\r\n          <form\r\n            action={`${API}/auth/logout/`}\r\n            method=\"post\"\r\n            className=\"pt-4\"\r\n          >\r\n            {/* We submit with JS below so we can include credentials, but provide a fallback link */}\r\n            <button\r\n              formAction={undefined}\r\n              onClick={async (e) => {\r\n                e.preventDefault();\r\n                try {\r\n                  await fetch(`${API}/auth/logout/`, {\r\n                    method: 'POST',\r\n                    credentials: 'include',\r\n                    headers: { Accept: 'application/json' },\r\n                  });\r\n                } finally {\r\n                  // always go home\r\n                  window.location.href = '/';\r\n                }\r\n              }}\r\n              className=\"inline-flex items-center gap-2 text-sm text-neutral-600 hover:text-black\"\r\n            >\r\n              <span aria-hidden>↩</span> Log out\r\n            </button>\r\n          </form>\r\n        </aside>\r\n\r\n        {/* Content */}\r\n        <section className=\"rounded border border-neutral-300\">\r\n          <div className=\"p-6\">\r\n            <h2 className=\"text-sm font-semibold uppercase tracking-wide\">\r\n              Personal Information\r\n            </h2>\r\n\r\n            <ClientEditableCard me={me} />\r\n          </div>\r\n        </section>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n/**\r\n * Client component: handles Edit / Save in place\r\n */\r\n'use client';\r\nimport { useState } from 'react';\r\n\r\nfunction ClientEditableCard({ me }: { me: UserMe }) {\r\n  const [editing, setEditing] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const [firstName, setFirstName] = useState(me.first_name ?? '');\r\n  const [lastName, setLastName] = useState(me.last_name ?? '');\r\n  const [phone, setPhone] = useState(me.phone ?? '');\r\n  const [address, setAddress] = useState(me.address ?? '');\r\n\r\n  const fullName = `${me.first_name ?? ''} ${me.last_name ?? ''}`.trim() || '—';\r\n\r\n  async function onSave() {\r\n    setSaving(true);\r\n    setErr(null);\r\n    try {\r\n      const res = await fetch(`${API}/auth/me/`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Accept: 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          first_name: firstName || null,\r\n          last_name: lastName || null,\r\n          phone: phone || null,\r\n          address: address || null,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json().catch(() => null);\r\n        throw new Error(\r\n          (data && (data.detail || data.error)) || 'Failed to save changes'\r\n        );\r\n      }\r\n\r\n      setEditing(false);\r\n      // reload the current route to get fresh server data (optional)\r\n      window.location.reload();\r\n    } catch (e: any) {\r\n      setErr(e.message || 'Failed to save changes');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  function onCancel() {\r\n    setFirstName(me.first_name ?? '');\r\n    setLastName(me.last_name ?? '');\r\n    setPhone(me.phone ?? '');\r\n    setAddress(me.address ?? '');\r\n    setEditing(false);\r\n    setErr(null);\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-6\">\r\n      {!editing ? (\r\n        <>\r\n          <div className=\"grid grid-cols-1 gap-8 md:grid-cols-2\">\r\n            <Field label=\"Full Name\" value={fullName} />\r\n            <Field label=\"Phone Number\" value={me.phone || '—'} />\r\n            <Field label=\"Email\" value={me.email} />\r\n            <Field label=\"Address\" value={me.address || '—'} wide />\r\n          </div>\r\n\r\n          <div className=\"mt-6 border-t border-neutral-200\" />\r\n          <div className=\"mt-4\">\r\n            <button\r\n              onClick={() => setEditing(true)}\r\n              className=\"inline-flex items-center gap-2 rounded border border-neutral-300 px-3 py-2 text-sm hover:bg-neutral-50\"\r\n            >\r\n              ✎ Edit\r\n            </button>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2\">\r\n            <Input\r\n              label=\"First name\"\r\n              value={firstName}\r\n              onChange={setFirstName}\r\n              placeholder=\"First name\"\r\n            />\r\n            <Input\r\n              label=\"Last name\"\r\n              value={lastName}\r\n              onChange={setLastName}\r\n              placeholder=\"Last name\"\r\n            />\r\n            <Input\r\n              label=\"Phone number\"\r\n              value={phone}\r\n              onChange={setPhone}\r\n              placeholder=\"+996 ...\"\r\n            />\r\n            <Input\r\n              label=\"Email\"\r\n              value={me.email}\r\n              onChange={() => {}}\r\n              disabled\r\n            />\r\n          </div>\r\n          <div className=\"mt-6\">\r\n            <Textarea\r\n              label=\"Address\"\r\n              value={address}\r\n              onChange={setAddress}\r\n              placeholder=\"Street, city, region, ZIP\"\r\n            />\r\n          </div>\r\n\r\n          {err && (\r\n            <p className=\"mt-3 text-sm text-red-600\">{err}</p>\r\n          )}\r\n\r\n          <div className=\"mt-6 flex items-center gap-3\">\r\n            <button\r\n              onClick={onSave}\r\n              disabled={saving}\r\n              className=\"rounded bg-black px-4 py-2 text-sm text-white disabled:opacity-60\"\r\n            >\r\n              {saving ? 'Saving…' : 'Save'}\r\n            </button>\r\n            <button\r\n              onClick={onCancel}\r\n              className=\"rounded border border-neutral-300 px-4 py-2 text-sm\"\r\n            >\r\n              Cancel\r\n            </button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Field({\r\n  label,\r\n  value,\r\n  wide = false,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  wide?: boolean;\r\n}) {\r\n  return (\r\n    <div className={wide ? 'md:col-span-2' : ''}>\r\n      <div className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </div>\r\n      <div className=\"mt-1 text-sm\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Input({\r\n  label,\r\n  value,\r\n  onChange,\r\n  disabled,\r\n  placeholder,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  onChange: (v: string) => void;\r\n  disabled?: boolean;\r\n  placeholder?: string;\r\n}) {\r\n  return (\r\n    <label className=\"block\">\r\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </span>\r\n      <input\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        disabled={disabled}\r\n        placeholder={placeholder}\r\n        className=\"mt-1 w-full rounded border border-neutral-300 px-3 py-2 text-sm outline-none focus:border-black disabled:bg-neutral-50\"\r\n      />\r\n    </label>\r\n  );\r\n}\r\n\r\nfunction Textarea({\r\n  label,\r\n  value,\r\n  onChange,\r\n  placeholder,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  onChange: (v: string) => void;\r\n  placeholder?: string;\r\n}) {\r\n  return (\r\n    <label className=\"block\">\r\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </span>\r\n      <textarea\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        placeholder={placeholder}\r\n        rows={3}\r\n        className=\"mt-1 w-full rounded border border-neutral-300 px-3 py-2 text-sm outline-none focus:border-black\"\r\n      />\r\n    </label>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}