{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/nelylook/front/front_nely/app/%28auth%29/account/ClientEditableCard.tsx"],"sourcesContent":["// app/account/ClientEditableCard.tsx\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { useAuth } from '@/app/contexts/AuthContext';\r\n\r\ntype UserMe = {\r\n  id: number | string;\r\n  email: string;\r\n  first_name?: string | null;\r\n  last_name?: string | null;\r\n  phone?: string | null;\r\n  address?: string | null;\r\n};\r\n\r\nexport default function ClientEditableCard({ me }: { me: UserMe }) {\r\n  const { checkAuth } = useAuth(); // Get the checkAuth function from context\r\n  const [editing, setEditing] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  const [firstName, setFirstName] = useState(me.first_name ?? '');\r\n  const [lastName, setLastName] = useState(me.last_name ?? '');\r\n  const [phone, setPhone] = useState(me.phone ?? '');\r\n  const [address, setAddress] = useState(me.address ?? '');\r\n\r\n  const fullName = `${me.first_name ?? ''} ${me.last_name ?? ''}`.trim() || '—';\r\n\r\n  async function onSave() {\r\n    setSaving(true);\r\n    setErr(null);\r\n    \r\n    try {\r\n      const res = await fetch('/api/auth/me', {\r\n        method: 'PATCH',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          first_name: firstName || null,\r\n          last_name: lastName || null,\r\n          phone: phone || null,\r\n          address: address || null,\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json().catch(() => null);\r\n        throw new Error(\r\n          (data && (data.detail || data.error)) || 'Не удалось сохранить изменения'\r\n        );\r\n      }\r\n\r\n      setEditing(false);\r\n      \r\n      // Update auth context instead of full page reload\r\n      await checkAuth();\r\n      \r\n      // Reload only the current page data\r\n      window.location.reload();\r\n    } catch (e: any) {\r\n      setErr(e.message || 'Не удалось сохранить изменения');\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  }\r\n\r\n  function onCancel() {\r\n    setFirstName(me.first_name ?? '');\r\n    setLastName(me.last_name ?? '');\r\n    setPhone(me.phone ?? '');\r\n    setAddress(me.address ?? '');\r\n    setEditing(false);\r\n    setErr(null);\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-6\">\r\n      {!editing ? (\r\n        <>\r\n          <div className=\"grid grid-cols-1 gap-8 md:grid-cols-2\">\r\n            <Field label=\"Полное имя\" value={fullName} />\r\n            <Field label=\"Телефон\" value={me.phone || '—'} />\r\n            <Field label=\"Email\" value={me.email} />\r\n            <Field label=\"Адрес\" value={me.address || '—'} wide />\r\n          </div>\r\n\r\n          <div className=\"mt-6 border-t border-neutral-200\" />\r\n          <div className=\"mt-4\">\r\n            <button\r\n              onClick={() => setEditing(true)}\r\n              className=\"inline-flex items-center gap-2 rounded border border-neutral-300 px-3 py-2 text-sm hover:bg-neutral-50 cursor-pointer transition-colors\"\r\n            >\r\n              ✎ Редактировать\r\n            </button>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className=\"grid grid-cols-1 gap-6 md:grid-cols-2\">\r\n            <Input\r\n              label=\"Имя\"\r\n              value={firstName}\r\n              onChange={setFirstName}\r\n              placeholder=\"Имя\"\r\n            />\r\n            <Input\r\n              label=\"Фамилия\"\r\n              value={lastName}\r\n              onChange={setLastName}\r\n              placeholder=\"Фамилия\"\r\n            />\r\n            <Input\r\n              label=\"Телефон\"\r\n              value={phone}\r\n              onChange={setPhone}\r\n              placeholder=\"+996700123456\"\r\n            />\r\n            <Input\r\n              label=\"Email\"\r\n              value={me.email}\r\n              onChange={() => {}}\r\n              disabled\r\n            />\r\n          </div>\r\n          <div className=\"mt-6\">\r\n            <Textarea\r\n              label=\"Адрес\"\r\n              value={address}\r\n              onChange={setAddress}\r\n              placeholder=\"Улица, город, регион, индекс\"\r\n            />\r\n          </div>\r\n\r\n          {err && (\r\n            <p className=\"mt-3 text-sm text-red-600\">{err}</p>\r\n          )}\r\n\r\n          <div className=\"mt-6 flex items-center gap-3\">\r\n            <button\r\n              onClick={onSave}\r\n              disabled={saving}\r\n              className=\"rounded bg-black px-4 py-2 text-sm text-white disabled:opacity-60 cursor-pointer disabled:cursor-not-allowed hover:bg-gray-800 transition-colors\"\r\n            >\r\n              {saving ? 'Сохраняем…' : 'Сохранить'}\r\n            </button>\r\n            <button\r\n              onClick={onCancel}\r\n              className=\"rounded border border-neutral-300 px-4 py-2 text-sm cursor-pointer hover:bg-neutral-50 transition-colors\"\r\n            >\r\n              Отмена\r\n            </button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Field({\r\n  label,\r\n  value,\r\n  wide = false,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  wide?: boolean;\r\n}) {\r\n  return (\r\n    <div className={wide ? 'md:col-span-2' : ''}>\r\n      <div className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </div>\r\n      <div className=\"mt-1 text-sm\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Input({\r\n  label,\r\n  value,\r\n  onChange,\r\n  disabled,\r\n  placeholder,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  onChange: (v: string) => void;\r\n  disabled?: boolean;\r\n  placeholder?: string;\r\n}) {\r\n  return (\r\n    <label className=\"block cursor-text\">\r\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </span>\r\n      <input\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        disabled={disabled}\r\n        placeholder={placeholder}\r\n        className=\"mt-1 w-full rounded border border-neutral-300 px-3 py-2 text-sm outline-none focus:border-black disabled:bg-neutral-50 cursor-text disabled:cursor-not-allowed\"\r\n      />\r\n    </label>\r\n  );\r\n}\r\n\r\nfunction Textarea({\r\n  label,\r\n  value,\r\n  onChange,\r\n  placeholder,\r\n}: {\r\n  label: string;\r\n  value: string;\r\n  onChange: (v: string) => void;\r\n  placeholder?: string;\r\n}) {\r\n  return (\r\n    <label className=\"block cursor-text\">\r\n      <span className=\"text-xs font-semibold uppercase tracking-wide text-neutral-700\">\r\n        {label}\r\n      </span>\r\n      <textarea\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        placeholder={placeholder}\r\n        rows={3}\r\n        className=\"mt-1 w-full rounded border border-neutral-300 px-3 py-2 text-sm outline-none focus:border-black cursor-text\"\r\n      />\r\n    </label>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}