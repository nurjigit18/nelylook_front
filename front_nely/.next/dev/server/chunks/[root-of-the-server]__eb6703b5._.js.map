{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/nelylook/front/front_nely/app/api/catalog/products/%5Bid%5D/route.ts"],"sourcesContent":["// app/api/catalog/products/[id]/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst BACKEND_URL = process.env.BACKEND_URL || 'http://127.0.0.1:8000';\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  { params }: { params: { id: string } }\r\n) {\r\n  try {\r\n    const productId = params.id;\r\n    \r\n    console.log('üîç Fetching product detail:', productId);\r\n    \r\n    // Fetch product details from Django\r\n    const response = await fetch(\r\n      `${BACKEND_URL}/catalog/products/${productId}/`,\r\n      {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        cache: 'no-store',\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        return NextResponse.json(\r\n          { error: 'Product not found' },\r\n          { status: 404 }\r\n        );\r\n      }\r\n      \r\n      console.error('‚ùå Django API error:', response.status);\r\n      return NextResponse.json(\r\n        { error: 'Failed to fetch product' },\r\n        { status: response.status }\r\n      );\r\n    }\r\n\r\n    const data = await response.json();\r\n    const product = data.data || data;\r\n    \r\n    console.log('‚úÖ Product fetched:', product.name);\r\n\r\n    // Fetch related products\r\n    let relatedProducts = [];\r\n    try {\r\n      const relatedResponse = await fetch(\r\n        `${BACKEND_URL}/catalog/products/${productId}/related/`,\r\n        {\r\n          method: 'GET',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          cache: 'no-store',\r\n        }\r\n      );\r\n      \r\n      if (relatedResponse.ok) {\r\n        const relatedData = await relatedResponse.json();\r\n        relatedProducts = (relatedData.data || relatedData.results || []).map((p: any) => ({\r\n          id: p.id,\r\n          href: `/catalog/products/${p.id}`,\r\n          imageSrc: p.images?.[0]?.url || '/placeholder.jpg',\r\n          imageAlt: p.name,\r\n          title: p.name,\r\n          sizeLabel: p.available_sizes?.map((s: any) => s.name).join(' ‚Äî ') || '',\r\n          priceFormatted: `${p.sale_price || p.base_price} —Å–æ–º`,\r\n          compareAtFormatted: p.sale_price ? `${p.base_price} —Å–æ–º` : undefined,\r\n          rating: p.rating || 4.5,\r\n        }));\r\n      }\r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è Failed to fetch related products:', error);\r\n    }\r\n\r\n    // Transform product data for frontend\r\n    const transformedProduct = {\r\n      id: product.id,\r\n      name: product.name,\r\n      slug: product.slug,\r\n      base_price: product.base_price,\r\n      sale_price: product.sale_price,\r\n      description: product.description,\r\n      short_description: product.short_description,\r\n      rating: product.rating || 4.5,\r\n      category_name: product.category_name,\r\n      season_display: product.season_display,\r\n      is_featured: product.is_featured,\r\n      is_new_arrival: product.is_new_arrival,\r\n      \r\n      // Available colors\r\n      available_colors: (product.available_colors || []).map((color: any) => ({\r\n        id: color.id,\r\n        name: color.name,\r\n        code: color.code || '#000000',\r\n      })),\r\n      \r\n      // Available sizes\r\n      available_sizes: (product.available_sizes || []).map((size: any) => ({\r\n        id: size.id,\r\n        name: size.name,\r\n      })),\r\n      \r\n      // Images\r\n      images: (product.images || []).map((img: any) => ({\r\n        id: img.id,\r\n        url: img.url,\r\n        alt_text: img.alt_text || product.name,\r\n        is_primary: img.is_primary,\r\n        display_order: img.display_order,\r\n        color_id: img.color?.id,\r\n      })),\r\n      \r\n      // Variants for stock checking\r\n      variants: product.variants || [],\r\n    };\r\n\r\n    return NextResponse.json({\r\n      product: transformedProduct,\r\n      relatedProducts,\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Error fetching product:', error);\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}